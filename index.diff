diff --git a/index.html b/index.html
index 55591deb73f04e8104785df7a1dc5454b3593a94..74c3821b2d0933b30ef0758b1c157eaa12f20de5 100644
--- a/index.html
+++ b/index.html
@@ -99,50 +99,56 @@
     .row {
       display:flex;
       gap:8px;
       margin-bottom:8px;
     }
     .row > div { flex:1; }
 
     .btn {
       display:inline-flex;
       align-items:center;
       justify-content:center;
       padding:8px 12px;
       border-radius:999px;
       border:none;
       cursor:pointer;
       font-size:0.9rem;
       font-weight:600;
       transition:transform 0.06s ease, box-shadow 0.06s ease, background 0.1s;
       white-space:nowrap;
     }
     .btn-primary {
       background:linear-gradient(135deg,#8CAF0B,#a9d51a);
       color:#111827;
       box-shadow:0 10px 25px rgba(140,175,11,0.45);
     }
+    .btn-no-glow {
+      box-shadow:none;
+    }
+    .btn-no-glow:active {
+      box-shadow:none;
+    }
     .btn-primary:active {
       transform:translateY(1px) scale(.99);
       box-shadow:0 4px 12px rgba(140,175,11,0.35);
     }
     .btn-secondary {
       background:#27272a;
       color:#e5e7eb;
       border:1px solid #3f3f46;
     }
     .btn-secondary:active {
       transform:translateY(1px) scale(.99);
       box-shadow:0 4px 12px rgba(0,0,0,0.7);
     }
     .btn-compact {
       padding:6px 10px;
       font-size:0.8rem;
     }
     .btn-api {
       flex:1;
     }
     .api-button-row {
       display:flex;
       gap:8px;
       align-items:center;
       margin-top:10px;
@@ -353,96 +359,125 @@
       justify-content:space-between;
       gap:8px;
     }
     .log-header-row span {
       font-size:1rem;
     }
     .log-toggle-btn {
       border-radius:999px;
       border:1px solid #3f3f46;
       background:#111111;
       color:#e5e7eb;
       font-size:0.75rem;
       padding:2px 8px;
       cursor:pointer;
     }
     .log-toggle-btn:hover {
       background:#1f1f1f;
     }
 
     #card-settings,
     #card-options,
     #card-stats,
     #card-log {
       width:100%;
     }
+
+    .cube-kind-option.disabled {
+      color:#6b7280;
+      opacity:0.55;
+    }
+
+    .main-stat-grid {
+      display:grid;
+      grid-template-columns:repeat(2, minmax(0,1fr));
+      gap:6px 12px;
+      margin-top:4px;
+    }
+
+    .auto-help {
+      margin:4px 0 6px;
+      font-size:0.8rem;
+      color:#a1a1aa;
+    }
+    .auto-help summary {
+      cursor:pointer;
+      list-style:none;
+      color:#cbd5f5;
+      font-weight:600;
+    }
+    .auto-help summary::marker {
+      display:none;
+    }
   </style>
     <!-- Google tag (gtag.js) -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=G-VZJQL22RBV"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
 
     gtag('config', 'G-VZJQL22RBV');
   </script>
 </head>
 <body>
   <h1>잠재능력 재설정 시뮬레이터</h1>
   <div class="subtitle">큐브 시뮬레이터</div>
   <div class="page-meta">
     <span id="updateDate"></span>
     <span>/ 제작: 크로아 - 윈메롱</span>
   </div>
 
   <div class="layout">
     <div class="layout-column">
       <!-- 1. 설정 카드 -->
       <section class="card" id="card-settings">
         <h2>설정</h2>
 
         <!-- 내 장비 불러오기 (Nexon Open API) -->
         <div style="margin-top:10px; padding-top:10px; border-top:1px dashed #2d2d2d;">
           <label style="margin-bottom:6px; font-size:0.9rem;">
             <input type="checkbox" id="useMyEquipToggle" />
             내 장비 불러오기 (API Key 필요)
           </label>
 
           <div id="myEquipPanel" style="display:none; margin-top:8px;">
             <div class="row">
               <div>
-                <label for="nxApiKey">Nexon Open API Key</label>
-                <input id="nxApiKey" type="password" placeholder="x-nxopen-api-key" style="width:100%; padding:6px 8px; border-radius:8px; border:1px solid #3f3f46; background:#111111; color:#e5e7eb; font-size:0.9rem;" />
-                <div class="api-button-row">
+                <div id="apiKeyInputWrap">
+                  <label for="nxApiKey">Nexon Open API Key</label>
+                  <input id="nxApiKey" type="password" placeholder="x-nxopen-api-key" style="width:100%; padding:6px 8px; border-radius:8px; border:1px solid #3f3f46; background:#111111; color:#e5e7eb; font-size:0.9rem;" />
+                </div>
+                <div class="api-button-row" id="apiKeyActions">
                   <button type="button" class="btn btn-secondary btn-compact btn-api" id="clearApiKeyBtn">저장된 키 삭제</button>
                 </div>
               </div>
-              <div>
+              <div id="myEquipNameArea">
                 <label for="characterName">캐릭터 닉네임</label>
                 <input id="characterName" type="text" placeholder="닉네임" style="width:100%; padding:6px 8px; border-radius:8px; border:1px solid #3f3f46; background:#111111; color:#e5e7eb; font-size:0.9rem;" />
                 <div class="api-button-row">
-                  <button type="button" class="btn btn-primary btn-compact btn-api" id="fetchMyEquipBtn">장비 불러오기</button>
+                  <button type="button" class="btn btn-primary btn-compact btn-api btn-no-glow" id="fetchMyEquipBtn">장비 불러오기</button>
                 </div>
                 <div id="myEquipStatus" style="margin-top:6px; font-size:0.8rem; color:#a1a1aa;"></div>
               </div>
             </div>
 
             <div class="row" style="margin-top:6px;">
               <div>
                 <label for="equipPreset">프리셋</label>
                 <select id="equipPreset">
                   <option value="1" selected>프리셋 1</option>
                   <option value="2">프리셋 2</option>
                   <option value="3">프리셋 3</option>
                 </select>
               </div>
               <div>
                 <label for="myEquipSelect">장비 선택 (레전만 가능)</label>
                 <select id="myEquipSelect" disabled>
                   <option value="">(먼저 장비를 불러오세요)</option>
                 </select>
               </div>
             </div>
 
             <div class="row" style="margin-top:6px;">
               <div>
                 <label>자동 설정</label>
@@ -482,155 +517,165 @@
             <option value="3">보조무기(포스실드 제외)</option>
             <option value="4">포스실드/소울링</option>
             <option value="5">방패</option>
             <option value="6">모자</option>
             <option value="7">상의</option>
             <option value="8">한벌옷</option>
             <option value="9">하의</option>
             <option value="10">신발</option>
             <option value="11">장갑</option>
             <option value="12">망토</option>
             <option value="13">벨트</option>
             <option value="14">어깨장식</option>
             <option value="15">얼굴장식</option>
             <option value="16">눈장식</option>
             <option value="17">귀고리</option>
             <option value="18">반지</option>
             <option value="19">펜던트</option>
             <option value="20">기계심장</option>
           </select>
         </div>
       </div>
 
       <div class="row">
         <div>
           <label>잠재능력 재설정 종류</label>
-          <label><input type="radio" name="cubeKind" value="black" checked />윗잠재 (블랙큐브)</label>
-          <label><input type="radio" name="cubeKind" value="meister" />명장의 큐브</label>
-          <label><input type="radio" name="cubeKind" value="addi" />아랫잠재 (에디셔널 큐브)</label>
+          <label class="cube-kind-option" data-cube-kind="black"><input type="radio" name="cubeKind" value="black" checked />윗잠재 (블랙큐브)</label>
+          <label class="cube-kind-option" data-cube-kind="meister"><input type="radio" name="cubeKind" value="meister" />명장의 큐브</label>
+          <label class="cube-kind-option" data-cube-kind="addi"><input type="radio" name="cubeKind" value="addi" />아랫잠재 (에디셔널 큐브)</label>
         </div>
         <div>
           <label>주스탯</label>
-          <div>
+          <div class="main-stat-grid">
             <label><input type="radio" name="mainStat" value="STR" checked />STR</label>
             <label><input type="radio" name="mainStat" value="DEX" />DEX</label>
             <label><input type="radio" name="mainStat" value="INT" />INT</label>
             <label><input type="radio" name="mainStat" value="LUK" />LUK</label>
             <label><input type="radio" name="mainStat" value="ALLSTAT" />올스탯 (제논 용)</label>
             <label><input type="radio" name="mainStat" value="ANY" />아무거나 (대장장이 용)</label>
           </div>
         </div>
       </div>
 
       <!-- 무기 전용 자동 돌리기 설정 UI -->
       <div id="weaponAutoContainer" style="margin-top:8px; display:none;">
         <!--
         <label style="margin-bottom:4px;">자동 돌리기 설정 (무기류/장신구/방어구)</label>
         <div style="font-size:0.8rem; color:#a1a1aa; margin-bottom:6px;">
           무기류: 보공/방무/공마 조합 & 에디 공마% 합계, 장신구/방어구: 주스탯% 및 에디 유효옵션 자동 돌리기 제공<br>
         </div>
         -->
 
         <!-- 아랫잠재(에디) 설정: ATK/MATK% 합계 임계값 -->
         <div data-auto-kind="addi-weapon">
           <label style="margin-bottom:4px;">아랫잠재 자동 돌리기 (공격력 / 마력 %)</label>
-          <div style="font-size:0.8rem; color:#a1a1aa; margin-bottom:4px;">
-            공격력/마력 % 합계가 설정값 이상이면 자동으로 멈춥니다.
-          </div>
+          <details class="auto-help">
+            <summary>설명 보기</summary>
+            <div>공격력/마력 % 합계가 설정값 이상이면 자동으로 멈춥니다.</div>
+          </details>
           <div style="display:flex; align-items:center; gap:8px;">
             <label for="weaponAutoTarget" style="margin:0; font-size:0.85rem;">목표 공마 %</label>
             <input type="number" id="weaponAutoTarget" value="21" min="0" max="39" style="max-width:80px;" />
           </div>
         </div>
 
         <!-- 아랫잠재(에디) 설정: 장신구/방어구 유효 옵션 줄 수 -->
         <div data-auto-kind="addi-stat" style="margin-top:10px;">
           <label style="margin-bottom:4px;">아랫잠재 자동 돌리기 (장신구/방어구)</label>
-          <div style="font-size:0.8rem; color:#a1a1aa; margin-bottom:6px;">
-            유효 옵션: 주스탯%/주스탯/공격력·마력/크뎀/쿨감(-1초)/9레벨당 주스탯<br>
-            올스탯 선택 시 2줄은 올스탯 1줄 이상, 2.5줄/3줄은 올스탯 2줄 이상<br>
-          </div>
+          <details class="auto-help">
+            <summary>설명 보기</summary>
+            <div>
+              유효 옵션: 주스탯%/주스탯/공격력·마력/크뎀/쿨감(-1초)/9레벨당 주스탯<br>
+              올스탯 선택 시 2줄은 올스탯 1줄 이상, 2.5줄/3줄은 올스탯 2줄 이상
+            </div>
+          </details>
           <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
             <label for="additionalAutoLines" style="margin:0; font-size:0.85rem;">유효 옵션 줄 수</label>
             <select id="additionalAutoLines" style="max-width:110px;">
               <option value="2">2줄</option>
               <option value="2.5">2.5줄</option>
               <option value="3">3줄</option>
             </select>
           </div>
           <div id="additionalCooldownRow" style="display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap;">
             <label style="margin:0; font-size:0.85rem;">
               <input type="checkbox" id="additionalCooldownRequired" />
               무조건 첫줄 쿨감
             </label>
           </div>
         </div>
 
         <!-- 윗잠재 설정: IED/Boss/ATK(MATK) 유효 조합 -->
         <div data-auto-kind="main" style="margin-top:10px;">
           <label style="margin-bottom:4px;">무보엠류 자동 돌리기 (유효 옵션 조합)</label>
-          <div style="font-size:0.8rem; color:#a1a1aa; margin-bottom:6px;">
-            최대 조건을 넘지 않는 후보가 나오면 자동으로 멈춤 <br>
-            예시1: 방무를 최대 1줄로 설정한다면, 유효 옵션은 '공공공', '공공방'<br>
-            예시2: 방무를 최대 0줄, 보공을 최대 1줄로 설정한다면, 유효 옵션은 '공공공', '보공공'
-          </div>
+          <details class="auto-help">
+            <summary>설명 보기</summary>
+            <div>
+              최대 조건을 넘지 않는 후보가 나오면 자동으로 멈춤 <br>
+              예시1: 방무를 최대 1줄로 설정한다면, 유효 옵션은 '공공공', '공공방'<br>
+              예시2: 방무를 최대 0줄, 보공을 최대 1줄로 설정한다면, 유효 옵션은 '공공공', '보공공'
+            </div>
+          </details>
 
           <div style="display:flex; align-items:center; gap:8px; white-space:nowrap;">
             <div style="display:flex; align-items:center; gap:8px;">
               <label for="autoMainIED" style="margin:0; font-size:0.85rem;">최대 방무 몇 줄</label>
               <select id="autoMainIED" style="max-width:110px;">
                 <option value="0">0</option>
                 <option value="1">1</option>
                 <option value="2">2</option>
                 <option value="3">3</option>
               </select>
             </div>
 
             <div id="autoMainBossRow" style="display:flex; align-items:center; gap:8px;">
               <label for="autoMainBossMin" style="margin:0; font-size:0.85rem;">최대 보공 몇 줄</label>
               <select id="autoMainBossMin" style="max-width:110px;"></select>
             </div>
           </div>
           <div style="display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap;">
             <label style="margin:0; font-size:0.85rem;">
               <input type="checkbox" id="autoMainSeekDeparture" />
               이탈 잠재 옵션 노리기
             </label>
             <span style="font-size:0.75rem; color:#a1a1aa;">
               2~3줄에 이탈옵 등장 시만 유효
             </span>
           </div>
         </div>
 
         <!-- 장신구/방어구 자동 돌리기: 주스탯% 합계 -->
         <div data-auto-kind="stat" style="margin-top:10px;">
           <label style="margin-bottom:4px;">장신구/방어구 자동 돌리기 (주스탯 %)</label>
-          <div style="font-size:0.8rem; color:#a1a1aa; margin-bottom:6px;">
-            주스탯이 목표 이상이면 멈춥니다. "아무거나"는 4개 주스탯 중 가장 큰 합을 사용<br>
-            "올스탯(제논 용)"은 STR/DEX/LUK을 각각 1/3 합산하며 올스탯%도 포함<br>
-            쿨감/크뎀/드메는 설정된 주스탯 목표에 상관 없이, 더 높으면 유효옵 판정
-          </div>
+          <details class="auto-help">
+            <summary>설명 보기</summary>
+            <div>
+              주스탯이 목표 이상이면 멈춥니다. "아무거나"는 4개 주스탯 중 가장 큰 합을 사용<br>
+              "올스탯(제논 용)"은 STR/DEX/LUK을 각각 1/3 합산하며 올스탯%도 포함<br>
+              쿨감/크뎀/드메는 설정된 주스탯 목표에 상관 없이, 더 높으면 유효옵 판정
+            </div>
+          </details>
 
           <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
             <label for="armorAutoTarget" style="margin:0; font-size:0.85rem;">목표 주스탯 %</label>
             <input type="number" id="armorAutoTarget" value="0" min="0" max="39" style="max-width:80px;" />
           </div>
 
           <div id="armorCooldownRow" style="display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap;">
             <label for="armorCooldownMin" style="margin:0; font-size:0.85rem;">목표 최소 쿨감</label>
             <select id="armorCooldownMin" style="max-width:110px;">
               <option value="0">0초</option>
               <option value="1">1초</option>
               <option value="2">2초</option>
               <option value="3">3초</option>
               <option value="4">4초</option>
               <option value="5">5초</option>
               <option value="6">6초</option>
             </select>
           </div>
 
           <div id="armorCritRow" style="display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap;">
             <label for="armorCritMin" style="margin:0; font-size:0.85rem;">목표 최소 크뎀 줄 수</label>
             <select id="armorCritMin" style="max-width:110px;">
               <option value="0">없음</option>
               <option value="1">크</option>
               <option value="2">크크</option>
@@ -744,56 +789,70 @@
       "보조무기": 3,
       "포스실드": 4,
       "소울링": 4,
       "방패": 5,
       "모자": 6,
       "상의": 7,
       "한벌옷": 8,
       "하의": 9,
       "신발": 10,
       "장갑": 11,
       "망토": 12,
       "벨트": 13,
       "어깨장식": 14,
       "얼굴장식": 15,
       "눈장식": 16,
       "귀고리": 17,
       "반지": 18,
       "펜던트": 19,
       "기계심장": 20
     };
 
     function normalizePartKey(name) {
       return String(name || "").trim();
     }
 
-    function resolvePartsType(partName, slotName, slotNo) {
+    function resolvePartsType(partName, slotName, slotNo, itemName) {
       const normalizedPart = normalizePartKey(partName);
+      const normalizedSlot = normalizePartKey(slotName);
+      const normalizedItem = normalizePartKey(itemName);
+
+      const isSubWeapon =
+        normalizedPart.includes("보조무기") || normalizedSlot.includes("보조무기");
+      if (isSubWeapon) {
+        if (normalizedItem.includes("소울링") || normalizedItem.includes("포스실드") || normalizedItem.includes("포스쉴드")) {
+          return PART_TO_PARTSTYPE["포스실드"];
+        }
+        if (normalizedItem.includes("방패")) {
+          return PART_TO_PARTSTYPE["방패"];
+        }
+        return PART_TO_PARTSTYPE["보조무기"];
+      }
+
       if (normalizedPart && PART_TO_PARTSTYPE[normalizedPart]) {
         return PART_TO_PARTSTYPE[normalizedPart];
       }
-      const normalizedSlot = normalizePartKey(slotName);
       if (normalizedSlot && PART_TO_PARTSTYPE[normalizedSlot]) {
         return PART_TO_PARTSTYPE[normalizedSlot];
       }
 
       const slotNumeric = Number(slotNo ?? normalizedSlot);
       if (Number.isFinite(slotNumeric) && slotNumeric >= 1 && slotNumeric <= 20) {
         return slotNumeric;
       }
 
       return null;
     }
 
     function isLegendary(grade) {
       return grade === "레전드리";
     }
 
     function getGradeInitial(grade) {
       if (!grade) return "-";
       const trimmed = String(grade).trim();
       return trimmed ? trimmed.charAt(0) : "-";
     }
 
     function formatDateYYYYMMDD(d) {
       const y = d.getFullYear();
       const m = String(d.getMonth() + 1).padStart(2, "0");
@@ -848,138 +907,155 @@
     }
 
     async function fetchOcidByName(name, apiKey) {
       const q = encodeURIComponent(name.trim());
       return nxFetch(`/id?character_name=${q}`, apiKey);
     }
 
     async function fetchItemEquipment(ocid, apiKey, dateStr) {
       const qOcid = encodeURIComponent(ocid);
       const qDate = encodeURIComponent(dateStr);
       return nxFetch(`/character/item-equipment?ocid=${qOcid}&date=${qDate}`, apiKey);
     }
 
     function normalizeNxEquipItems(raw, presetNo) {
       if (!raw) return [];
       const list = raw.item_equipment || [];
       const out = [];
       list.forEach((it, idx) => {
         // preset: item_equipment_preset_no 값이 있는 경우만 필터
         const pno = it.item_equipment_preset_no;
         if (presetNo && pno && String(pno) !== String(presetNo)) return;
 
         const partName = it.item_equipment_part || "";
         const slotName = it.item_equipment_slot || "";
         const slotNo = it.item_equipment_slot_no ?? it.item_equipment_slot;
-        const partsType = resolvePartsType(partName, slotName, slotNo);
+        const partsType = resolvePartsType(partName, slotName, slotNo, it.item_name);
 
         const mainGrade = it.potential_option_grade ?? null;
         const addGrade  = it.additional_potential_option_grade ?? null;
 
         const key = `${partName}|${it.item_name}|${it.item_equipment_slot || ""}|${idx}`;
 
         out.push({
           key,
           idx,
           item_name: it.item_name,
           partName,
           partsType,
           reqLev: it.item_base_option?.base_equipment_level ?? it.item_base_option?.base_req_level ?? it.item_description?.req_lev ?? it.item_equipment_req_level ?? it.item_equipment_level ?? it.item_equipment_req_lev ?? it.item_equipment_reqlev ?? it.item_req_lev ?? it.item_equipment_req ?? it.item_equipment_req_level ?? it.item_equipment_req_lev, // defensive
           // most reliable in your sample: item_equipment_req_level
           reqLev2: it.item_equipment_req_level,
           mainGrade,
           addGrade,
           mainLines: [it.potential_option_1, it.potential_option_2, it.potential_option_3].filter(Boolean),
           addLines: [it.additional_potential_option_1, it.additional_potential_option_2, it.additional_potential_option_3].filter(Boolean),
         });
       });
 
       // reqLev 정리: sample 기준 item_equipment_req_level 사용
       out.forEach(o => {
         const v = Number(o.reqLev2 ?? o.reqLev);
         o.reqLev = Number.isFinite(v) && v > 0 ? v : null;
       });
 
       return out;
     }
 
     function buildEquipOptionLabel(e) {
       const main = getGradeInitial(e.mainGrade);
       const add = getGradeInitial(e.addGrade);
       const part = e.partName || "?";
-      return `[${part}] ${e.item_name} (${main}/${add})`;
+      return `[${part}] ${e.item_name} [${main}/${add}]`;
     }
 
     function renderMyEquipSelect() {
       const sel = document.getElementById("myEquipSelect");
       if (!sel) return;
       sel.innerHTML = "";
 
       if (!nxEquipItems.length) {
         const opt = document.createElement("option");
         opt.value = "";
         opt.textContent = "(선택 가능한 장비가 없습니다)";
         sel.appendChild(opt);
         sel.disabled = true;
         return;
       }
 
       const placeholder = document.createElement("option");
       placeholder.value = "";
       placeholder.textContent = "(아이템을 선택하세요)";
       sel.appendChild(placeholder);
 
       nxEquipItems.forEach(e => {
         const opt = document.createElement("option");
         opt.value = e.key;
         opt.textContent = buildEquipOptionLabel(e);
         const enabled = isLegendary(e.mainGrade) || isLegendary(e.addGrade);
         if (!enabled) opt.disabled = true;
         sel.appendChild(opt);
       });
 
       sel.disabled = false;
     }
 
     function getSelectedNxEquip() {
       return nxEquipItems.find(e => e.key === selectedEquipKey) || null;
     }
 
     function updateMyEquipSideUI(equip) {
       const hint = document.getElementById("myEquipSideHint");
 
       if (!equip) {
         if (hint) hint.textContent = "";
         return;
       }
 
       const partsLabel = equip.partName || "-";
       const lvLabel = equip.reqLev ? `Lv.${equip.reqLev}` : "-";
-      const info = `${partsLabel} / ${lvLabel} | 윗:${equip.mainGrade ?? "-"} / 아랫:${equip.addGrade ?? "-"}`;
+      const main = getGradeInitial(equip.mainGrade);
+      const add = getGradeInitial(equip.addGrade);
+      const info = `${partsLabel} / ${lvLabel} | [${main}/${add}]`;
       if (hint) hint.textContent = info;
     }
 
+    function updateCubeKindAvailability(equip) {
+      const options = document.querySelectorAll(".cube-kind-option");
+      const mainOk = equip ? isSideLegendary(equip, "main") : true;
+      const addOk = equip ? isSideLegendary(equip, "addi") : true;
+
+      options.forEach(label => {
+        const kind = label.getAttribute("data-cube-kind");
+        if (!kind) return;
+        const radio = label.querySelector("input[type='radio']");
+        const shouldDisable = kind === "addi" ? !addOk : !mainOk;
+        if (radio) radio.disabled = shouldDisable;
+        label.classList.toggle("disabled", shouldDisable);
+      });
+    }
+
     function normalizeStatText(text) {
       return (text || "").replace(/\s+/g, "");
     }
 
     function detectMainStatFromLines(lines) {
       const counts = { STR: 0, DEX: 0, INT: 0, LUK: 0, ALLSTAT: 0 };
       if (!Array.isArray(lines)) return null;
       lines.forEach(line => {
         const text = normalizeStatText(line);
         if (!text) return;
         if (text.includes("올스탯")) counts.ALLSTAT += 1;
         if (text.includes("STR") || text.includes("힘")) counts.STR += 1;
         if (text.includes("DEX") || text.includes("민첩")) counts.DEX += 1;
         if (text.includes("INT") || text.includes("지력")) counts.INT += 1;
         if (text.includes("LUK") || text.includes("운")) counts.LUK += 1;
       });
 
       let max = 0;
       Object.values(counts).forEach(val => {
         if (val > max) max = val;
       });
       if (!max) return null;
 
       const winners = Object.entries(counts).filter(([, val]) => val === max);
       if (winners.length !== 1) return null;
@@ -1062,50 +1138,51 @@
         return;
       }
 
       // 레벨/부위 자동 설정 + lock
       const itemLevelSel = document.getElementById("itemLevel");
       const partsTypeSel = document.getElementById("partsType");
 
       // itemLevel 옵션에 없는 레벨이면 가장 가까운 상위(?)가 아니라 그대로는 불가능.
       // 현재 UI는 100/120/130/140/150/160/200/250만 지원하므로, 그 외 레벨은 가장 가까운 구간으로 매핑.
       const supported = [100,120,130,140,150,160,200,250];
       let mapped = equip.reqLev;
       if (!supported.includes(mapped)) {
         // 일반적으로 140/160/200/250 구간이므로, 가장 가까운 하한으로 snap
         mapped = supported.reduce((best, v) => (Math.abs(v - equip.reqLev) < Math.abs(best - equip.reqLev) ? v : best), supported[0]);
       }
 
       if (itemLevelSel) itemLevelSel.value = String(mapped);
       if (partsTypeSel) partsTypeSel.value = String(equip.partsType);
 
       // 표시
       const auto = document.getElementById("myEquipAutoPartLevel");
       if (auto) auto.textContent = `${equip.partName} / Lv.${equip.reqLev}`;
 
       // 큐브 종류 유효성 보정
       ensureValidCubeKindForEquip(equip);
+      updateCubeKindAvailability(equip);
 
       // 현재 옵션을 "내 장비 잠재"로 덮어쓰기
       const cubeKind = getSelectedCubeKind();
       const linesText = getEquipLinesForCubeKind(equip, cubeKind);
       const lines = [];
       for (let i = 0; i < 3; i++) {
         const t = linesText[i] || "-";
         lines.push({ line: i+1, optionText: t, raw: null });
       }
       currentLines = lines;
       rollCandidates = [[], [], []];
 
       // 통계 초기화 + 렌더
       meisterUsed = 0;
       mesoUsed = 0;
       rollCount = 0;
       logEntries = [];
       document.getElementById("log").textContent = "";
       updateCubeTag();
       updateStatsTags();
       renderAllBoxes();
     }
 
     function resetAutoConditionDefaults({ save = true } = {}) {
       const weaponAutoTarget = document.getElementById("weaponAutoTarget");
@@ -1777,186 +1854,214 @@
     ].forEach(id => {
       const el = document.getElementById(id);
       if (!el) return;
       const evt = el.type === "number" || el.tagName === "INPUT" ? "input" : "change";
       el.addEventListener(evt, () => {
         saveCurrentSettings();
       });
       if (el.tagName === "SELECT" || el.type === "checkbox") {
         el.addEventListener("change", () => {
           saveCurrentSettings();
         });
       }
     });
 
     document.getElementById("toggleLogBtn").addEventListener("click", () => {
       logVisible = !logVisible;
       updateLogVisibility();
     });
 
     
     // ====== 내 장비 불러오기 UI 바인딩 ======
     function initMyEquipUI() {
       const toggle = document.getElementById("useMyEquipToggle");
       const panel = document.getElementById("myEquipPanel");
       const apiInput = document.getElementById("nxApiKey");
+      const apiInputWrap = document.getElementById("apiKeyInputWrap");
+      const apiActions = document.getElementById("apiKeyActions");
       const clearBtn = document.getElementById("clearApiKeyBtn");
       const nameInput = document.getElementById("characterName");
       const fetchBtn = document.getElementById("fetchMyEquipBtn");
       const presetSel = document.getElementById("equipPreset");
       const equipSel = document.getElementById("myEquipSelect");
+      const nameArea = document.getElementById("myEquipNameArea");
 
       // load saved api key
       const savedKey = localStorage.getItem(NX_API_STORAGE_KEY);
       if (savedKey && apiInput) apiInput.value = savedKey;
 
+      function updateApiKeyUI() {
+        const hasKey = Boolean((apiInput?.value || "").trim());
+        if (apiInputWrap) apiInputWrap.style.display = hasKey ? "none" : "block";
+        if (apiActions) apiActions.style.display = hasKey ? "flex" : "none";
+        if (nameArea) nameArea.style.display = hasKey ? "block" : "none";
+      }
+
       function setPanelVisible(v) {
         if (panel) panel.style.display = v ? "block" : "none";
       }
 
       function setMode(v) {
         useMyEquip = v;
         setPanelVisible(v);
         window.dispatchEvent(new Event("cubeSim:refreshAutoPanel"));
         if (!v) {
           // release lock and reset UI
           setControlsDisabledByMyEquipMode(false);
           nxEquipRaw = null;
           nxEquipItems = [];
           selectedEquipKey = "";
           const auto = document.getElementById("myEquipAutoPartLevel");
           if (auto) auto.textContent = "-";
           updateMyEquipSideUI(null);
           window.dispatchEvent(new Event("cubeSim:refreshAutoPanel"));
           if (equipSel) {
             equipSel.innerHTML = "<option value=''> (먼저 장비를 불러오세요) </option>";
             equipSel.disabled = true;
           }
           setMyEquipStatus("");
+          updateCubeKindAvailability(null);
           // 기존 동작으로 복귀: 현재 설정값 기반 재초기화
           initCurrentOption();
         }
       }
 
       if (toggle) {
         toggle.addEventListener("change", () => {
           setMode(toggle.checked);
+          updateApiKeyUI();
         });
       }
 
       if (clearBtn) {
         clearBtn.addEventListener("click", () => {
           localStorage.removeItem(NX_API_STORAGE_KEY);
           if (apiInput) apiInput.value = "";
+          updateApiKeyUI();
           setMyEquipStatus("저장된 키를 삭제했습니다.");
         });
       }
 
       async function doFetchEquip() {
-        const apiKey = (apiInput?.value || "").trim();
+        const apiKey = (apiInput?.value || localStorage.getItem(NX_API_STORAGE_KEY) || "").trim();
         const name = (nameInput?.value || "").trim();
         if (!apiKey) { alert("API Key를 입력하세요."); return; }
         if (!name) { alert("닉네임을 입력하세요."); return; }
 
         setMyEquipStatus("OCID 조회 중...");
         fetchBtn.disabled = true;
 
         try {
           const ocidRes = await fetchOcidByName(name, apiKey);
           const ocid = ocidRes?.ocid;
           if (!ocid) throw new Error("OCID를 찾지 못했습니다.");
 
           const dateStr = getDefaultNxDate();
           setMyEquipStatus(`장비 조회 중... (기준일자: ${dateStr})`);
           const equipRes = await fetchItemEquipment(ocid, apiKey, dateStr);
           nxEquipRaw = equipRes;
 
           // 저장(성공 시)
           localStorage.setItem(NX_API_STORAGE_KEY, apiKey);
+          if (apiInput) apiInput.value = apiKey;
+          updateApiKeyUI();
 
           // preset 반영
           const presetNo = presetSel?.value || "1";
           nxEquipItems = normalizeNxEquipItems(nxEquipRaw, presetNo);
 
           // item_equipment_preset_# 값이 없는 응답이면 위 필터로 다 비게 될 수 있으니 fallback
           if (!nxEquipItems.length) {
             nxEquipItems = normalizeNxEquipItems(nxEquipRaw, null);
           }
 
           renderMyEquipSelect();
           resetAutoConditionDefaults();
           setMyEquipStatus(`불러오기 완료: ${nxEquipItems.length}개 장비`);
 
           const detectedStat = detectMainStatFromEquipList(nxEquipItems, getSelectedCubeKind());
           applyMainStatSelection(detectedStat);
 
           // my mode에서 레벨/부위 선택 잠그기(아이템 선택 후)
           setControlsDisabledByMyEquipMode(true);
           window.dispatchEvent(new Event("cubeSim:refreshAutoPanel"));
 
           // 프리셋 변경 시 아이템 재구성
         } catch (err) {
           console.error(err);
           setMyEquipStatus(`불러오기 실패: ${err.message}`, true);
           alert(`불러오기 실패: ${err.message}`);
         } finally {
           fetchBtn.disabled = false;
         }
       }
 
       if (fetchBtn) fetchBtn.addEventListener("click", doFetchEquip);
+      if (apiInput) {
+        apiInput.addEventListener("change", () => {
+          const value = apiInput.value.trim();
+          if (value) {
+            localStorage.setItem(NX_API_STORAGE_KEY, value);
+          } else {
+            localStorage.removeItem(NX_API_STORAGE_KEY);
+          }
+          updateApiKeyUI();
+        });
+      }
 
       if (presetSel) {
         presetSel.addEventListener("change", () => {
           if (!nxEquipRaw) return;
           const presetNo = presetSel.value;
           nxEquipItems = normalizeNxEquipItems(nxEquipRaw, presetNo);
           if (!nxEquipItems.length) nxEquipItems = normalizeNxEquipItems(nxEquipRaw, null);
           selectedEquipKey = "";
           renderMyEquipSelect();
           updateMyEquipSideUI(null);
           window.dispatchEvent(new Event("cubeSim:refreshAutoPanel"));
         });
       }
 
       if (equipSel) {
         equipSel.addEventListener("change", () => {
           selectedEquipKey = equipSel.value;
           const eq = getSelectedNxEquip();
           updateMyEquipSideUI(eq);
 
           if (!eq) return;
 
           // 기본 side가 레전더리인지 확인 후 적용
           ensureValidCubeKindForEquip(eq);
+          updateCubeKindAvailability(eq);
           applyNxEquipToSimulator(eq);
           window.dispatchEvent(new Event("cubeSim:refreshAutoPanel"));
         });
       }
 
       // 초기 토글 상태
       setPanelVisible(false);
+      updateApiKeyUI();
     }
 
 const storedSettings = getStoredSettings();
     applyStoredSettings(storedSettings);
     updateCubeTag();
     updateLogVisibility();
     initMyEquipUI();
 
     // ====== 업데이트 내역 토글 ======
     window.addEventListener("load", () => {
       const box = document.getElementById("changelog");
       const btn = document.getElementById("toggleChangelogBtn");
       if (!box || !btn) return;
 
       let changelogVisible = false;
 
       function updateChangelogVisibility() {
         box.style.display = changelogVisible ? "block" : "none";
         btn.textContent = changelogVisible ? "업데이트 내역 접기" : "업데이트 내역 보기";
       }
 
       btn.addEventListener("click", () => {
         changelogVisible = !changelogVisible;
         updateChangelogVisibility();
       });
